"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[31],{9031:(e,t,i)=>{i.r(t),i.d(t,{default:()=>M});var n=i(8554),o=i(6044),r=i(9996);let a="#1E2939";var s=i(140);s.EA.workerSrc=new i.U(i(5186)).toString();class l{async load(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=await s.YE(e).promise;this.pdf=i,this.pdfLoaded=!0;let n=await Promise.all(Array.from({length:i.numPages}).map((e,t)=>i.getPage(t+1))),o=new Map,r=new Map;n.forEach(e=>{var i;let n=e.getViewport({scale:t}),a=null!=(i=r.get(n.width))?i:1;r.set(n.width,a+1),o.set(e.pageNumber,{width:n.width,height:n.height})});let a=new Map(r.entries().map(e=>{let[t,i]=e;return[i,t]})),l=Math.max(...a.keys()),c=a.get(l);if(!c)throw Error("Failed to get major page width");return{pdf:i,dominantPageWidth:c,pageDimensions:o}}calculatePagePositions(e){let{pageDimensions:t,dominantPageWidth:i,viewportWidth:n,pageGap:o}=e,r=o;return t.entries().map((e,t)=>{let[a,s]=e,l=.8*n,c=i>l?l/i:1,d=s.width*c,h=s.height*c,u=r+t*o;return r+=h,{pageNumber:a,dimensions:{width:d,height:h},position:{x:n/2-d/2,y:u}}}).toArray()}async loadPage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(null===this.pdf)throw Error("PDF not loaded yet.");let i=await this.pdf.getPage(e),n=i.getViewport({scale:t}),o=window.devicePixelRatio||1,r=document.createElement("canvas"),a=r.getContext("2d");return r.width=Math.floor(n.width*o),r.height=Math.floor(n.height*o),r.style.width=Math.floor(n.width)+"px",r.style.height=Math.floor(n.height)+"px",await i.render({canvas:r,canvasContext:a,transform:1!==o?[o,0,0,o,0,0]:void 0,viewport:n}).promise,{page:i,canvas:r}}dispose(){var e;this.pdfLoaded=!1,null==(e=this.pdf)||e.destroy()}constructor(){this.pdfLoaded=!1}}function c(e,t){let i=e,n=t.scale;i>0&&(i=0);let o=t.pagePositions[t.pagePositions.length-1],r=o.dimensions.height*n,a=o.position.y*n+r-t.height+24*n;return i<-a&&(i=-a),i}function d(e){let t=e.scale,i=e.pagePositions[0];for(let t of e.pagePositions)t.dimensions.width>i.dimensions.width&&(i=t);let n=i.dimensions.width*t,o=i.position.x*t,r=24*t;return{minX:e.width-(o+n)-r,maxX:r-o,largestPageWidth:n}}function h(e,t){let i=e/2,n=e*t/2;return Math.abs(i-n)*(i>n?1:-1)}var u=i(1394);let g=u.createContext(null),p=u.createContext(null);function b(e){let[t,i]=(0,u.useState)({status:"loading",scale:1,width:0,height:0,x:0,y:0,dominantPageWidth:0,pageDimensions:new Map,pagePositions:[],currentPage:1,totalPages:1,pointer:{x:-1e3,y:-1e3},objects:new Map,pageObjects:new Map,selectedObjectKey:null,objectToPlace:null}),o=(0,u.useCallback)(e=>{i(t=>{let i=Math.max(Math.min(e,3),.25),n=h(t.width,i);return{...t,x:n,scale:i}})},[]),r=(0,u.useCallback)(e=>{i(t=>{let i=t.pagePositions.find(t=>t.pageNumber===e);if(void 0===i)return t;let n=i.position.y*t.scale-24;return{...t,currentPage:e,y:-n}})},[]),a=(0,u.useCallback)(e=>{i(t=>({...t,objectToPlace:e?{...e,position:{x:0,y:0},placed:!1}:null}))},[]),s=(0,u.useMemo)(()=>({setViewportScale:o,goToPage:r,setObjectToPlace:a}),[o,r,a]);return(0,u.useEffect)(()=>{window.pdfview=s},[s]),(0,n.jsx)(p.Provider,{value:s,children:(0,n.jsx)(g.Provider,{value:[t,i],children:e.children})})}var w=i(7209);function f(e){let t=(0,u.useContext)(g);if(!t)throw Error("PDFView must be child of PDFViewProvider.");let[i,a]=t,s=(0,u.useRef)(null);function p(e){let t=e.deltaY,i=e.deltaX,n=e.deltaY>0?-1:1,o=e.modPressed?1.05:1,r=e.pointer;a(e=>{if(1!==o){let t=n>0?Math.min(e.scale*o,3):Math.max(e.scale/o,.25),i=(r.y-e.y)/e.scale,a=h(e.width,t),s=c(r.y-i*t,{...e,scale:t});return{...e,y:s,x:a,scale:t}}let a=function(e){let t=e.currentPage,i=1/0,n=-e.y+e.height/2;return e.pagePositions.forEach(o=>{let r=o.position.y*e.scale,a=r+o.dimensions.height*e.scale,s=Math.abs((r+a)/2-n);s<i&&(i=s,t=o.pageNumber)}),t}(e),s=c(e.y-t,e),l=function(e,t){let{minX:i,maxX:n,largestPageWidth:o}=d(t),r=e;return o<=t.width?r=t.x:(r>n&&(r=n),r<i&&(r=i)),r}(e.x-i,e);return{...e,currentPage:a,y:s,x:l}})}if((0,u.useEffect)(function(){if(null===e.containerRef.current)return;let t=e.containerRef.current,i=t.getBoundingClientRect();a(e=>({...e,width:i.width,height:i.height}));let n=new l;n.load(e.src,2).then(e=>{let{pdf:t,dominantPageWidth:o,pageDimensions:r}=e,s=n.calculatePagePositions({pageDimensions:r,dominantPageWidth:o,viewportWidth:i.width,pageGap:24});a(e=>({...e,status:"success",dominantPageWidth:o,pageDimensions:r,pagePositions:s,totalPages:t.numPages,objectToPlace:null,selectedObjectKey:null,objects:new Map,pageObjects:new Map}))}).catch(e=>{a(e=>({...e,status:"error"})),console.error("[PDFView] Failed to load document. Cause:",e)}),s.current=n;let o=null,r=new ResizeObserver(e=>{let t=e[0].contentRect;null!==o&&clearTimeout(o),o=setTimeout(()=>{a(e=>{if(0===e.dominantPageWidth)return e;let i=n.calculatePagePositions({pageDimensions:e.pageDimensions,dominantPageWidth:e.dominantPageWidth,viewportWidth:t.width,pageGap:24});return{...e,pagePositions:i,width:t.width,height:t.height}})},150)});r.observe(t);let c=new AbortController;return window.addEventListener("keydown",e=>{"Escape"===e.key&&a(e=>({...e,selectedObjectKey:null,objectToPlace:null})),("Backspace"===e.key||"Delete"===e.key)&&a(e=>{let t=e.selectedObjectKey;if(!t)return e;let i=new Map(e.objects);i.delete(t);let n=new Map(e.pageObjects);if(n.has(e.currentPage)){let i=n.get(e.currentPage).filter(e=>e!==t);n.set(e.currentPage,i)}return{...e,objects:i,pageObjects:n,selectedObjectKey:null}})},{signal:c.signal}),()=>{var e;c.abort(),r.disconnect(),null==(e=s.current)||e.dispose()}},[e.src]),"loading"===i.status)return null;let b=2*i.height,f=i.pagePositions.filter(e=>{let t=e.position.y*i.scale,n=t+e.dimensions.height*i.scale,o=-i.y,r=o+i.height;return n>=o-b&&t<=r+b});return(0,n.jsxs)(w.BI,{width:i.width,height:i.height,onWheel:function(e){e.evt.preventDefault();let t=e.currentTarget,i=e.evt.deltaY,n=e.evt.deltaX,o=t.getPointerPosition();p({deltaX:n,deltaY:i,modPressed:e.evt.ctrlKey||e.evt.metaKey,pointer:o})},onMouseMove:e=>{let t=e.currentTarget.getPointerPosition();a(e=>({...e,pointer:t}))},onClick:()=>{a(e=>({...e,selectedObjectKey:null,objectToPlace:null}))},className:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(0,r.QP)((0,o.$)(t))}("overflow-hidden",{}),children:[(0,n.jsx)(w.Wd,{scaleX:i.scale,scaleY:i.scale,x:i.x,y:i.y,onWheel:function(e){e.evt.preventDefault();let t=e.currentTarget.getStage(),i=e.evt.deltaY,n=e.evt.deltaX,o=t.getPointerPosition();p({deltaX:n,deltaY:i,modPressed:e.evt.ctrlKey||e.evt.metaKey,pointer:o})},children:f.map(t=>{let{pageNumber:i,dimensions:o,position:r}=t;return(0,n.jsx)(j,{loaderRef:s,pageNumber:i,dimensions:o,position:r,RenderObject:e.RenderObject},i)})}),(0,n.jsxs)(w.Wd,{children:[(0,n.jsx)(x,{state:i,onYUpdate:e=>a(t=>({...t,y:e}))}),(0,n.jsx)(y,{state:i,onXUpdate:e=>a(t=>({...t,x:e}))}),i.objectToPlace&&e.RenderObject&&(0,n.jsx)(P,{scale:i.scale,pointer:i.pointer,objectToPlace:i.objectToPlace,RenderObject:e.RenderObject})]})]})}function j(e){let t=(0,u.useContext)(g);if(!t)throw Error("PDFView must be child of PDFViewProvider.");let[i,o]=t,r=(0,u.useRef)(null),[s,l]=(0,u.useState)(void 0);(0,u.useEffect)(function(){let t=e.loaderRef.current;null!==t&&setTimeout(()=>{t.loadPage(e.pageNumber,2).then(e=>{let{canvas:t}=e;l(t)}).catch(e=>{console.error("[PDFPage] Failed to load page. Cause:",e)})},300)},[e.pageNumber]);let c=e.RenderObject,d=(0,u.useMemo)(()=>{var t;if(!c)return[];let n=null!=(t=i.pageObjects.get(e.pageNumber))?t:[],o=[];for(let e of n){let t=i.objects.get(e);t&&o.push(t)}return o},[e.pageNumber,c,i.pageObjects,i.objects]);return(0,n.jsxs)(w.YJ,{...e.position,clipX:0,clipY:0,clipWidth:e.dimensions.width,clipHeight:e.dimensions.height,ref:r,onClick:t=>{let n=t.currentTarget.getRelativePointerPosition();!function(e,t){if(!i.objectToPlace)return;let n={id:i.objectToPlace.id,position:t,dimensions:i.objectToPlace.dimensions,tag:i.objectToPlace.tag,data:i.objectToPlace.data,placed:!0};o(t=>{let i=new Map(t.objects);i.set(n.id,n);let o=new Map(t.pageObjects);return o.has(e)||o.set(e,[]),o.get(e).includes(n.id)||o.get(e).push(n.id),{...t,objects:i,pageObjects:o,objectToPlace:null}}),setTimeout(()=>{o(e=>({...e,selectedObjectKey:n.id}))},100)}(e.pageNumber,n)},children:[!s&&(0,n.jsx)(w.rw,{...e.dimensions,fill:"white",stroke:a,strokeWidth:1}),s&&(0,n.jsx)(w._V,{...e.dimensions,x:.5,y:.5,width:e.dimensions.width-1,height:e.dimensions.height-1,image:s,stroke:a,strokeWidth:1/i.scale,strokeAfterFill:!0,alt:"Page ".concat(e.pageNumber)}),s&&d.map(e=>(0,n.jsx)(m,{object:e,RenderObject:c},e.id))]})}function m(e){let t=(0,u.useContext)(g);if(!t)throw Error("PDFView must be child of PDFViewProvider.");let[i,o]=t,r=e.object.dimensions.width,a=e.object.dimensions.height,s=e.object.position.x-r/2,l=e.object.position.y-a/2,c=e.object.id===i.selectedObjectKey,d=(0,u.useRef)(null),h=(0,u.useRef)(null);return(0,u.useEffect)(()=>{if(c&&h.current&&d.current){var e;h.current.nodes([d.current]),null==(e=h.current.getLayer())||e.batchDraw()}},[c]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(w.YJ,{draggable:!0,onTransformEnd:t=>{let i=t.target,n=i.position(),r=i.size();o(t=>{let i=new Map(t.objects);return i.set(e.object.id,{...e.object,position:{x:n.x+r.width/2,y:n.y+r.height/2}}),{...t,objects:i}})},onDragStart:()=>{o(t=>({...t,selectedObjectKey:e.object.id}))},onDragEnd:t=>{let i=t.target,n=i.position(),r=i.size();o(t=>{let i=new Map(t.objects);return i.set(e.object.id,{...e.object,position:{x:n.x+r.width/2,y:n.y+r.height/2}}),{...t,objects:i}})},ref:d,width:r,height:a,x:s,y:l,onClick:t=>{t.cancelBubble=!0,o(t=>({...t,selectedObjectKey:e.object.id}))},children:(0,n.jsx)(e.RenderObject,{object:e.object,remove:()=>{o(t=>{let i=new Map(t.objects);i.delete(e.object.id);let n=new Map(t.pageObjects);if(n.has(t.currentPage)){let i=n.get(t.currentPage).filter(t=>t!==e.object.id);n.set(t.currentPage,i)}return{...t,objects:i,pageObjects:n,selectedObjectKey:null}})}})}),c&&(0,n.jsx)(w.Ge,{ref:h,rotateEnabled:!1,keepRatio:!0,enabledAnchors:["top-left","top-right","bottom-left","bottom-right"],boundBoxFunc:(e,t)=>{let n=20*i.scale;return t.width<n||t.height<n?e:t},borderStroke:"black",borderStrokeWidth:i.scale,borderDash:[4*i.scale,4*i.scale],borderDashEnabled:!0,anchorSize:3*i.scale,anchorStroke:"black",anchorStrokeWidth:i.scale,anchorFill:"black",anchorCornerRadius:100})]})}function P(e){let t=e.objectToPlace.dimensions.width*e.scale,i=e.objectToPlace.dimensions.height*e.scale,o=e.pointer.x-t/2,r=e.pointer.y-i/2;return(0,n.jsx)(w.YJ,{width:t,height:i,x:o,y:r,children:(0,n.jsx)(e.RenderObject,{object:{...e.objectToPlace,dimensions:{width:t,height:i}},remove:()=>{}})})}function x(e){var t;let{state:i}=e,o=i.pagePositions[i.pagePositions.length-1],r=(o.position.y+o.dimensions.height+24)*i.scale,a=i.height,s=Math.max(20,a/r*a),l=2*i.scale,c=i.height-(l+10),d=(t=-i.y,l+(t- -24)/(r- -24)*(c-l)),[h,g]=(0,u.useState)(!1);return(0,n.jsx)(w.rw,{draggable:!0,dragBoundFunc:function(e){let t=e.y;return t<l&&(t=l),t>c-s&&(t=c-s),{y:t,x:i.width-9}},onDragStart:()=>g(!0),onDragMove:t=>{let{y:i}=t.currentTarget.position(),n=-(-24+(i-l)/(c-l)*(r- -24));e.onYUpdate(n)},onDragEnd:()=>g(!1),y:h?void 0:d,x:i.width-9,width:6,height:s,fill:"#c9c9c9",cornerRadius:3})}function y(e){var t;let{state:i}=e,o=i.width,r=o/(o*i.scale),a=o*r,{minX:s,maxX:l}=d(i),c=o-a,h=(t=i.x,c+(t-s)/(l-s)*(0-c)),g=i.scale>1.05,[p,b]=(0,u.useState)(!1);return g?(0,n.jsx)(w.rw,{draggable:!0,dragBoundFunc:function(e){let t=e.x;return t>=c&&(t=c),t<0&&(t=0),{y:i.height-8,x:t}},onDragStart:()=>b(!0),onDragEnd:()=>b(!1),onDragMove:t=>{let{x:i}=t.currentTarget.position(),n=s+(i-c)/(0-c)*(l-s);e.onXUpdate(n)},x:p?void 0:h,y:i.height-8,width:a,height:6,fill:"#c9c9c9",cornerRadius:3}):null}var v=i(4419);function M(){let e=(0,u.useRef)(null);return(0,n.jsxs)(b,{children:[(0,n.jsx)(k,{}),(0,n.jsxs)("div",{ref:e,className:"relative h-[800px] w-[90vw] border border-slate-100",children:[(0,n.jsx)(f,{src:"http://localhost:3000/sample.pdf",containerRef:e,RenderObject:O}),(0,n.jsx)(D,{})]})]})}function k(){let e=function(){let e=(0,u.useContext)(p);if(!e)throw Error("PDFView must be child of PDFViewProvider.");return e}();return(0,n.jsx)("div",{children:(0,n.jsx)("img",{onClick:()=>{e.setObjectToPlace({id:(0,v.Ak)(),dimensions:{width:38,height:38},tag:"image",data:{src:"https://picsum.photos/100/100"}})},src:"https://picsum.photos/100/100",className:"size-6"})})}function O(e){let[t,i]=(0,u.useState)(null);return((0,u.useEffect)(()=>{let t=new window.Image;t.src=e.object.data.src,t.onload=()=>{i(t)}},[e.object]),t)?(0,n.jsx)(w._V,{image:t,width:e.object.dimensions.width,height:e.object.dimensions.height,listening:e.object.placed,alt:""}):null}function D(){let{currentPage:e,totalPages:t}=function(){let e=(0,u.useContext)(g);if(!e)throw Error("PDFView must be child of PDFViewProvider.");let[t]=e;return{status:t.status,scale:t.scale,currentPage:t.currentPage,totalPages:t.totalPages}}();return(0,n.jsxs)("div",{className:"absolute bottom-2 left-2 rounded-md border border-slate-300 bg-white px-2 py-1 text-slate-900 shadow-xs",children:[e," / ",t]})}}}]);